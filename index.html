<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="äº¬éƒ½æ¢ç´¢3D">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="äº¬éƒ½æ¢ç´¢3D - Bloomãƒ»å¤©å€™ãƒ»å’Œé¢¨BGMæ­è¼‰ã®æ²¡å…¥å‹æ•£ç­–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼">
    <title>äº¬éƒ½æ¢ç´¢ 3D | Kyoto Explorer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;700&family=Zen+Kaku+Gothic+New:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <canvas id="game-canvas"></canvas>

    <div id="ui-layer">
        <header id="hdr">
            <div class="logo"><span class="k1">äº¬</span><span class="k2">éƒ½</span><span class="k3">EXPLORER<span
                        class="k4">3D</span></span></div>
            <div class="hdr-r">
                <span class="pill" id="weather-pill">â˜€ï¸ æ™´</span>
                <span class="pill" id="time-pill">é»„æ˜</span>
                <span class="pill" id="fps-pill">--</span>
                <button class="pill sound-pill" id="sound-pill">ğŸ”Š</button>
            </div>
        </header>

        <div id="spot-popup" class="spot-popup hide">
            <div class="sp-ico" id="sp-ico">â›©ï¸</div>
            <div class="sp-body">
                <h3 id="sp-name">-</h3>
                <p id="sp-desc">-</p>
            </div>
            <div class="sp-tag" id="sp-tag">NEW</div>
        </div>

        <div id="minimap"><canvas id="mm-cv" width="160" height="160"></canvas>
            <div class="mm-you"></div>
        </div>

        <div id="crosshair"><i class="ch t"></i><i class="ch r"></i><i class="ch b"></i><i class="ch l"></i><i
                class="ch d"></i></div>

        <div id="compass"><canvas id="compass-cv" width="50" height="50"></canvas></div>

        <div id="steps-counter"><span id="steps-num">0</span><span class="steps-lbl">æ­©</span></div>

        <div id="touch-ui">
            <div id="joy-zone">
                <div id="joy-base">
                    <div id="joy-knob"></div>
                </div>
            </div>
            <div id="look-zone"></div>
        </div>

        <nav id="bnav">
            <button class="nb" id="btn-cam"><span class="ni">ğŸ“·</span><span class="nl">æ’®å½±</span></button>
            <button class="nb" id="btn-map"><span class="ni">ğŸ—ºï¸</span><span class="nl">åœ°å›³</span></button>
            <button class="nb active" id="btn-walk"><span class="ni">ğŸ‘£</span><span class="nl">æ¢ç´¢</span></button>
            <button class="nb" id="btn-book"><span class="ni">ğŸ“œ</span><span class="nl">å¾¡æœ±å°</span></button>
            <button class="nb" id="btn-cfg"><span class="ni">âš™ï¸</span><span class="nl">è¨­å®š</span></button>
        </nav>

        <div id="ad-bar" class="hide">
            <div class="ab-inner"><span class="ab-tag">AD</span>
                <div class="ab-txt">ğŸµ äº¬éƒ½ã®æ—…ã‚’ã‚‚ã£ã¨æ¥½ã—ã â€• ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã§åºƒå‘Šéè¡¨ç¤º</div><button class="ab-x" id="ab-x">âœ•</button>
            </div>
        </div>
    </div>

    <!-- Interstitial -->
    <div id="m-ad" class="mf hide">
        <div class="ad-box">
            <div class="ad-timer" id="ad-t">5</div>
            <div class="ad-body">
                <div class="ad-hero">ğŸµ å®‡æ²»èŒ¶æœ¬èˆ—</div>
                <p class="ad-sub">æœ¬å ´ãƒ»å®‡æ²»ã®æŠ¹èŒ¶ã‚’ã”è‡ªå®…ã«</p><button class="ad-cta">è©³ã—ãã¯ã“ã¡ã‚‰</button>
            </div>
            <button class="ad-skip hide" id="ad-skip">ã‚¹ã‚­ãƒƒãƒ— â–¶</button>
        </div>
    </div>

    <!-- Gosyuin -->
    <div id="m-book" class="mf hide">
        <div class="mc book-c"><button class="mx">âœ•</button>
            <h2 class="mt">å¾¡æœ±å°å¸³</h2>
            <div class="gs-grid" id="gs-grid"></div>
            <div class="gs-prog"><span id="gs-count">0</span>/15 åé›†æ¸ˆ</div>
        </div>
    </div>

    <!-- Settings -->
    <div id="m-cfg" class="mf hide">
        <div class="mc cfg-c"><button class="mx">âœ•</button>
            <h2 class="mt">æ—…ã®è¨­å®š</h2>
            <div class="cfg-list">
                <label class="cfg"><span>ğŸŒ¸ æ¡œå¹é›ª</span><input type="checkbox" checked id="opt-sakura"></label>
                <label class="cfg"><span>ğŸ”¦ æ‡ä¸­é›»ç¯</span><input type="checkbox" id="opt-flash"></label>
                <label class="cfg"><span>âœ¨ ãƒ–ãƒ«ãƒ¼ãƒ </span><input type="checkbox" checked id="opt-bloom"></label>
                <label class="cfg"><span>ğŸš¶ ãƒ˜ãƒƒãƒ‰ãƒœãƒ–</span><input type="checkbox" checked id="opt-bob"></label>
                <div class="cfg"><span>ğŸŒ™ æ™‚é–“å¸¯</span><select id="opt-time">
                        <option value="dawn">æœç„¼ã‘</option>
                        <option value="day">æ˜¼é–“</option>
                        <option value="dusk" selected>é»„æ˜</option>
                        <option value="night">å¤œ</option>
                    </select></div>
                <div class="cfg"><span>ğŸŒ¦ï¸ å¤©å€™</span><select id="opt-weather">
                        <option value="clear" selected>æ™´ã‚Œ</option>
                        <option value="rain">é›¨</option>
                        <option value="snow">é›ª</option>
                        <option value="fog">éœ§</option>
                    </select></div>
                <div class="cfg"><span>ğŸµ BGMéŸ³é‡</span><input type="range" min="0" max="100" value="25" id="opt-bgm">
                </div>
                <div class="cfg"><span>ğŸ”Š SEéŸ³é‡</span><input type="range" min="0" max="100" value="50" id="opt-se"></div>
                <div class="cfg"><span>ğŸŒ¿ BGSéŸ³é‡</span><input type="range" min="0" max="100" value="15" id="opt-bgs">
                </div>
                <div class="cfg premium"><span>ğŸ’ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ </span><button class="prem-btn">åºƒå‘Šã‚’éè¡¨ç¤º</button></div>
            </div>
        </div>
    </div>

    <!-- Map -->
    <div id="m-map" class="mf hide">
        <div class="mc map-c"><button class="mx">âœ•</button>
            <h2 class="mt">äº¬éƒ½æ¡ˆå†…å›³</h2>
            <div class="map-wrap"><canvas id="map-cv" width="450" height="450"></canvas></div>
            <div class="map-leg">
                <span class="ml"><i class="md ct"></i>é³¥å±…</span><span class="ml"><i class="md cm"></i>å¯ºé™¢</span>
                <span class="ml"><i class="md cg"></i>åº­åœ’</span><span class="ml"><i class="md cb"></i>æ©‹</span>
                <span class="ml"><i class="md ci"></i>èŠ±è¡—</span><span class="ml"><i class="md cy"></i>ç¾åœ¨åœ°</span>
            </div>
        </div>
    </div>

    <!-- Photo -->
    <div id="m-photo" class="mf hide">
        <div class="mc"><button class="mx">âœ•</button>
            <h2 class="mt">ğŸ“· ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ</h2>
            <canvas id="photo-cv"></canvas>
            <div class="photo-acts"><button class="pbtn" id="p-save">ğŸ’¾ ä¿å­˜</button><button class="pbtn" id="p-close">âœ•
                    é–‰ã˜ã‚‹</button></div>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="start">
        <div class="s-bg"></div>
        <div class="s-particles" id="s-particles"></div>
        <div class="s-content">
            <div class="s-gate">â›©ï¸</div>
            <h1 class="s-title"><span class="st1">äº¬éƒ½æ¢ç´¢</span><span class="st2">3D IMMERSIVE SIMULATOR</span></h1>
            <p class="s-sub">å¤éƒ½ã®æƒ…ç·’ã‚ãµã‚Œã‚‹è¡—ä¸¦ã¿ã‚’ â€• å­£ç¯€ãƒ»å¤©å€™ãƒ»æ™‚é–“ã‚’è‡ªç”±ã«å¤‰ãˆã¦æ¢ç´¢ã—ã‚ˆã†</p>
            <div class="s-features">
                <span class="sf">ğŸŒ¸ æ¡œå¹é›ª</span><span class="sf">ğŸŒ§ï¸ å¤©å€™å¤‰åŒ–</span><span class="sf">ğŸµ å’Œé¢¨BGM</span><span
                    class="sf">ğŸŒ™ æ˜¼å¤œã‚µã‚¤ã‚¯ãƒ«</span>
            </div>
            <button class="s-btn" id="btn-start"><span>æ¢ç´¢ã‚’å§‹ã‚ã‚‹</span>
                <div class="btn-glow"></div>
            </button>
            <div class="s-keys">
                <p><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> ç§»å‹• ãƒ» ãƒã‚¦ã‚¹ã§è¦–ç‚¹æ“ä½œ</p>
                <p>ğŸ“± ãƒ¢ãƒã‚¤ãƒ«/iOS: ã‚¸ãƒ§ã‚¤ã‚¹ãƒ†ã‚£ãƒƒã‚¯ + ã‚¿ãƒƒãƒ</p>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="hide">
        <div class="ld-c">
            <div class="ld-ring">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <h2 class="ld-t">äº¬éƒ½ã‚’æ§‹ç¯‰ä¸­</h2>
            <p class="ld-sub" id="ld-msg">åˆæœŸåŒ–...</p>
            <div class="ld-bar">
                <div id="ld-fill"></div>
            </div>
            <p class="ld-tip">ğŸ’¡ é³¥å±…ã‚’ããã‚‹ã¨å¾¡æœ±å°ãŒã‚‚ã‚‰ãˆã¾ã™</p>
        </div>
    </div>

    <!-- Error fallback -->
    <div id="err-scr" class="hide">
        <div class="ld-c">
            <h2 class="ld-t" style="color:#e8384f">âš  ã‚¨ãƒ©ãƒ¼</h2>
            <p class="ld-sub" id="err-msg">Three.jsã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
            <button class="s-btn" onclick="location.reload()" style="margin-top:16px"><span>å†èª­è¾¼</span></button>
        </div>
    </div>

    <script>
        /* Preload check - ensure THREE loaded before app */
        window._threeLoaded = false;
        window._threeError = false;
        window.addEventListener('error', function (e) {
            if (e.filename && e.filename.indexOf('three') !== -1) {
                window._threeError = true;
                document.getElementById('start').style.display = 'none';
                document.getElementById('err-scr').classList.remove('hide');
            }
        }, true);
    </script>
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js" onload="window._threeLoaded=true"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://unpkg.com/three@0.160.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="js/audio.js"></script>
    <script>
        /* Startup guard - wait for THREE then load app */
        (function check() {
            if (window._threeError) return;
            if (window._threeLoaded && window.THREE) {
                var s = document.createElement('script');
                s.src = 'js/app.js';
                s.onerror = function () { document.getElementById('err-scr').classList.remove('hide'); };
                document.body.appendChild(s);
            } else { setTimeout(check, 100); }
        })();
    </script>
</body>

</html>
